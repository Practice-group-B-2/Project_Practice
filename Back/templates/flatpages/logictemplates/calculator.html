<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ—Ü–µ–ø—Ç—ã</title>
    <link rel="stylesheet" href="{% static 'css/calculator.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {% comment %} <nav class="main-nav">
        <div class="nav-center">
            <a href="/" class="nav-button">
                <i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è
            </a>
            <div class="nav-right">
                {% if user.is_authenticated %}
                    <a href="{% url 'users:account' %}" class="nav-button">
                        <i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å
                    </a>
                    <a href="{% url 'users:logout' %}" class="nav-button">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </a>
                {% else %}
                    <a href="{% url 'users:login' %}" class="nav-button">
                        <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                    </a>
                    <a href="{% url 'users:registration' %}" class="nav-button">
                        <i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                    </a>
                {% endif %}
            </div>
        </div>
    </nav>  {% endcomment %}

    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <div class="input-group">
                <label for="ageSlider">–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç:</label>
                <div class="slider-container">
                    <input type="range" id="ageSlider" min="1" max="100" value="30" class="slider">
                    <span id="ageValue">30</span>
                </div>
            </div>
            <label for="weightInput">–í–∞—à –≤–µ—Å (–∫–≥):</label>
            <input type="number" id="weightInput" min="30" max="200" value="{{ card_data.weight|default:70 }}">

            <label for="diseaseSelect">–í–∞—à–∞ –±–æ–ª–µ–∑–Ω—å:</label>
            <select id="diseaseSelect">
                <option value="none" {% if card_data and card_data.sickness == 'none' %}selected{% endif %}>–ù–µ—Ç –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π</option>
                <option value="diabetes" {% if card_data and card_data.sickness == 'diabetes' %}selected{% endif %}>–°–∞—Ö–∞—Ä–Ω—ã–π –¥–∏–∞–±–µ—Ç</option>
                <option value="celiac" {% if card_data and card_data.sickness == 'celiac' %}selected{% endif %}>–¶–µ–ª–∏–∞–∫–∏—è</option>
                <option value="phenylketonuria" {% if card_data and card_data.sickness == 'phenylketonuria' %}selected{% endif %}>–§–µ–Ω–∏–ª–∫–µ—Ç–æ–Ω—É—Ä–∏—è</option>
                <option value="lactose" {% if card_data and card_data.sickness == 'lactose' %}selected{% endif %}>–ù–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –ª–∞–∫—Ç–æ–∑—ã</option>
            </select>

            <button onclick="closeWelcomeModal()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <div class="modal-overlay"></div>

    <div class="container">
        <h1><i class="fas fa-utensils"></i> –†–µ—Ü–µ–ø—Ç—ã</h1>

        <div class="search-filter">
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤...">
            <select id="filterDropdown">
                <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <option value="–°—É–ø">–°—É–ø</option>
                <option value="–°–∞–ª–∞—Ç">–°–∞–ª–∞—Ç</option>
                <option value="–†—ã–±–∞">–†—ã–±–∞</option>
                <option value="–ñ–∞—Ä–∫–æ–µ">–ñ–∞—Ä–∫–æ–µ</option>
                <option value="–†–∞–≥—É">–†–∞–≥—É</option>
            </select>
        </div>

        <div class="trade-list">
            {% for item in trade_items %}
            <div class="trade-item" data-category="{{ item.category }}" data-diabetic="{{ item.diabetic|yesno:'true,false' }}" data-low-calorie="{{ item.low_calorie|yesno:'true,false' }}" data-low-salt="{{ item.low_salt|yesno:'true,false' }}">
                <span class="nutrition-badge">{{ item.nutrition.calories }} –∫–∫–∞–ª</span>
                <img src="{% static 'images/' %}{{ item.image }}" alt="{{ item.name }}" class="item-image">
                <h3 class="item-name">{{ item.name }}</h3>
                <p class="item-description">{{ item.description }}</p>
                <div class="health-indicator">
                    {% if item.diabetic %}
                    <span class="health-icon" title="–î–ª—è –¥–∏–∞–±–µ—Ç–∏–∫–æ–≤">ü©∏</span>
                    {% endif %}
                    {% if item.low_calorie %}
                    <span class="health-icon" title="–ù–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ">‚öñÔ∏è</span>
                    {% endif %}
                    {% if item.low_salt %}
                    <span class="health-icon" title="–ù–∏–∑–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–ª–∏">üßÇ</span>
                    {% endif %}
                </div>
                <button class="calculator-btn" onclick="showCalculator('{{ item.name }}')">
                    <i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                </button>
                <button onclick="showRecipeModal('{{ item.video_url }}', '{{ item.name }}', '{{ item.description }}')">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="recipe-modal">
        <div class="modal-content">
            <span class="close" onclick="closeRecipeModal()">&times;</span>
            <h2 id="modal-recipe-title"></h2>
            <p id="modal-recipe-description"></p>
            <iframe id="modal-recipe-video" width="560" height="315" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>

    <div id="calculatorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCalculatorModal()">&times;</span>
            <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–∏—â–µ–≤–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏</h2>
            <div class="input-group">
                <label for="portionWeight">–í–µ—Å –ø–æ—Ä—Ü–∏–∏ (–≥):</label>
                <input type="number" id="portionWeight" min="50" max="1000" value="100">
            </div>
            <div class="input-group">
                <label for="calculatorDiseaseSelect">–í–∞—à–∞ –±–æ–ª–µ–∑–Ω—å:</label>
                <select id="calculatorDiseaseSelect">
                    <option value="none">–ù–µ—Ç –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π</option>
                    <option value="diabetes">–°–∞—Ö–∞—Ä–Ω—ã–π –¥–∏–∞–±–µ—Ç</option>
                    <option value="celiac">–¶–µ–ª–∏–∞–∫–∏—è</option>
                    <option value="phenylketonuria">–§–µ–Ω–∏–ª–∫–µ—Ç–æ–Ω—É—Ä–∏—è</option>
                    <option value="lactose">–ù–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –ª–∞–∫—Ç–æ–∑—ã</option>
                </select>
            </div>
            <div id="nutritionResults" style="display: none;">
                <h3>–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å:</h3>
                <p>–ö–∞–ª–æ—Ä–∏–∏: <span id="calories">0</span> –∫–∫–∞–ª</p>
                <p>–ë–µ–ª–∫–∏: <span id="protein">0</span> –≥</p>
                <p>–£–≥–ª–µ–≤–æ–¥—ã: <span id="carbs">0</span> –≥</p>
                <p>–ñ–∏—Ä—ã: <span id="fat">0</span> –≥</p>
                <div id="diseaseRecommendations" style="margin-top: 15px; padding: 10px; background-color: #f0f8ff; border-radius: 5px;">
                    <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                    <p id="recommendationText"></p>
                </div>
            </div>
            <button onclick="calculateNutrition()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        </div>
    </div>

    <script src="{% static 'js/calculatorScripts.js' %}"></script>
    <script>
        const CALCULATE_URL = "{% url 'calculator:calculate_nutrition' %}";

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        {% if card_data %}
        document.addEventListener('DOMContentLoaded', function() {
            // –î–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            document.getElementById('weightInput').value = {{ card_data.weight }};
            document.getElementById('diseaseSelect').value = "{{ card_data.sickness }}";
            // –î–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
            if (document.getElementById('calculatorDiseaseSelect')) {
                document.getElementById('calculatorDiseaseSelect').value = "{{ card_data.sickness }}";
            }
        });
        {% endif %}
    </script>
</body>
</html>